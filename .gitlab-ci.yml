stages:
  - build
  - deploy

variables:
  DOCKER_IMAGE_BACKEND: scriptify-backend:latest
  DOCKER_IMAGE_FRONTEND: scriptify-frontend:latest

# 1️⃣ Build Backend
build-backend:
  stage: build
  tags:
    - local
  script:
    - echo "=== Building Backend Image ==="
    - docker build -t $DOCKER_IMAGE_BACKEND ./backend

# 2️⃣ Build Frontend
build-frontend:
  stage: build
  tags:
    - local
  script:
    - echo "=== Building Frontend Image ==="
    - docker build -t $DOCKER_IMAGE_FRONTEND ./frontend

# 3️⃣ Deploy to Kubernetes
deploy:
  stage: deploy
  tags:
    - local
  script:
    - echo "=== Deploying to Kubernetes ==="
    - kubectl apply -f k8s/
    - kubectl rollout status deployment/backend-deployment
    - kubectl rollout status deployment/frontend-deployment
